<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="676px" preserveAspectRatio="none" style="width:840px;height:676px;" version="1.1" viewBox="0 0 840 676" width="840px" zoomAndPan="magnify"><defs><filter height="300%" id="f1hwbtbqb9llhb" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="372.5938" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="37" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="116.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="217" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="58.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="342" y="146.5625"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="158.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="477" y="287.2266"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="477" y="535.2891"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="640" y="345.4922"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="140.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="777" y="175.6953"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="234.0625" style="stroke: #000000; stroke-width: 2.0;" width="816.5" x="13" y="248.9609"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="424.5" x="405" y="497.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="42" x2="42" y1="86.2969" y2="589.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="222" x2="222" y1="86.2969" y2="589.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="347" x2="347" y1="86.2969" y2="589.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="482" x2="482" y1="86.2969" y2="589.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="645" x2="645" y1="86.2969" y2="589.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="781.5" x2="781.5" y1="86.2969" y2="589.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="23" y="82.9951">User</text><ellipse cx="42" cy="13" fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M42,21 L42,48 M29,29 L55,29 M42,48 L29,63 M42,48 L55,63 " fill="none" filter="url(#f1hwbtbqb9llhb)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="23" y="601.417">User</text><ellipse cx="42" cy="614.7188" fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M42,622.7188 L42,649.7188 M29,630.7188 L55,630.7188 M42,649.7188 L29,664.7188 M42,649.7188 L55,664.7188 " fill="none" filter="url(#f1hwbtbqb9llhb)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="195" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="202" y="70.9951">Slack</text><rect fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="195" y="588.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="202" y="608.417">Slack</text><rect fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="289" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="296" y="70.9951">nimbot_server</text><rect fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="289" y="588.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="296" y="608.417">nimbot_server</text><rect fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="415" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="422" y="70.9951">nimbot_executor</text><rect fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="415" y="588.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="422" y="608.417">nimbot_executor</text><rect fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="611" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="618" y="70.9951">Docker</text><rect fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="611" y="588.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="618" y="608.417">Docker</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="744.5" y="82.9951">MongoDB</text><path d="M764,34 C764,24 782,24 782,24 C782,24 800,24 800,34 L800,60 C800,70 782,70 782,70 C782,70 764,70 764,60 L764,34 " fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M764,34 C764,44 782,44 782,44 C782,44 800,44 800,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="744.5" y="601.417">MongoDB</text><path d="M764,614.7188 C764,604.7188 782,604.7188 782,604.7188 C782,604.7188 800,604.7188 800,614.7188 L800,640.7188 C800,650.7188 782,650.7188 782,650.7188 C782,650.7188 764,650.7188 764,640.7188 L764,614.7188 " fill="#FEFECE" filter="url(#f1hwbtbqb9llhb)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M764,614.7188 C764,624.7188 782,624.7188 782,624.7188 C782,624.7188 800,624.7188 800,614.7188 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="372.5938" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="37" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="116.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="217" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="58.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="342" y="146.5625"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="158.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="477" y="287.2266"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="477" y="535.2891"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="640" y="345.4922"/><rect fill="#FFFFFF" filter="url(#f1hwbtbqb9llhb)" height="140.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="777" y="175.6953"/><polygon fill="#A80036" points="205,113.4297,215,117.4297,205,121.4297,209,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="211" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="54" y="112.3638">Send "/nimbot c" code</text><polygon fill="#A80036" points="330,142.5625,340,146.5625,330,150.5625,334,146.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="227" x2="336" y1="146.5625" y2="146.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="234" y="141.4966">POST /play</text><polygon fill="#A80036" points="765,171.6953,775,175.6953,765,179.6953,769,175.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="771" y1="175.6953" y2="175.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="359" y="170.6294">Save a code of POST body</text><polygon fill="#A80036" points="238,200.8281,228,204.8281,238,208.8281,234,204.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="232" x2="346" y1="204.8281" y2="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="244" y="199.7622">Response "ok"</text><polygon fill="#A80036" points="58,229.9609,48,233.9609,58,237.9609,54,233.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="221" y1="233.9609" y2="233.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="64" y="228.895">"ok"</text><path d="M13,248.9609 L77,248.9609 L77,255.9609 L67,265.9609 L13,265.9609 L13,248.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="234.0625" style="stroke: #000000; stroke-width: 2.0;" width="816.5" x="13" y="248.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="28" y="262.0278">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="92" y="261.1714">[when codes exist]</text><polygon fill="#A80036" points="765,283.2266,775,287.2266,765,291.2266,769,287.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487" x2="771" y1="287.2266" y2="287.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="494" y="282.1606">Fetch codes and delete</text><polygon fill="#A80036" points="498,312.3594,488,316.3594,498,320.3594,494,316.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="492" x2="781" y1="316.3594" y2="316.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="504" y="311.2935">Result</text><polygon fill="#A80036" points="628,341.4922,638,345.4922,628,349.4922,632,345.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487" x2="634" y1="345.4922" y2="345.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="494" y="340.4263">docker run</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="650" x2="692" y1="374.625" y2="374.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="692" y1="374.625" y2="387.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="651" x2="692" y1="387.625" y2="387.625"/><polygon fill="#A80036" points="661,383.625,651,387.625,661,391.625,657,387.625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="657" y="369.5591">nim c -r main.nim</text><polygon fill="#A80036" points="498,412.7578,488,416.7578,498,420.7578,494,416.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="492" x2="644" y1="416.7578" y2="416.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="504" y="411.6919">Return stdout/stderr</text><polygon fill="#A80036" points="233,441.8906,223,445.8906,233,449.8906,229,445.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="227" x2="481" y1="445.8906" y2="445.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="239" y="440.8247">POST to incomming webhook</text><polygon fill="#A80036" points="58,471.0234,48,475.0234,58,479.0234,54,475.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="221" y1="475.0234" y2="475.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="64" y="469.9575">Print code/stdout/stderr</text><path d="M405,497.0234 L469,497.0234 L469,504.0234 L459,514.0234 L405,514.0234 L405,497.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="424.5" x="405" y="497.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="420" y="510.0903">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="182" x="484" y="509.2339">[when codes does not exist]</text><polygon fill="#A80036" points="770,531.2891,780,535.2891,770,539.2891,774,535.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487" x2="776" y1="535.2891" y2="535.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="494" y="530.2231">Fetch codes and delete</text><polygon fill="#A80036" points="493,560.4219,483,564.4219,493,568.4219,489,564.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487" x2="781" y1="564.4219" y2="564.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="499" y="559.356">Result</text><!--
@startuml data_flow

actor User as user
participant Slack as slack
participant nimbot_server as server
participant nimbot_executor as exec
participant Docker as container
database MongoDB as db

user -> slack : Send "/nimbot c" code
activate user
activate slack
slack -> server : POST /play
activate server
server -> db : Save a code of POST body
activate db
server -> slack : Response "ok"
deactivate server
slack -> user : "ok"
deactivate slack

alt when codes exist
    exec -> db : Fetch codes and delete
    activate exec
    db -> exec : Result
    deactivate db
    exec -> container : docker run
    activate container
    container -> container : nim c -r main.nim
    container -> exec : Return stdout/stderr
    deactivate container
    exec -> slack : POST to incomming webhook
    deactivate exec
    slack -> user : Print code/stdout/stderr
end
deactivate user

alt when codes does not exist
    exec -> db : Fetch codes and delete
    activate exec
    db -> exec : Result
    deactivate exec
end

@enduml

PlantUML version 1.2019.09(Tue Aug 27 01:19:51 JST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.6+10-post-Ubuntu-1ubuntu119.10.1
Operating System: Linux
OS Version: 5.3.0-42-generic
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>